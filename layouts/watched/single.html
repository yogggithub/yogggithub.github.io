{{- define "main" }} {{- $urlPath := .RelPermalink }} {{- $pathParts := split
$urlPath "/" }} {{- $id := "" }} {{- range $pathParts }} {{- if and (ne . "")
(ne . "watched") }} {{- $id = . }} {{- end }} {{- end }} {{- $item := index
(where .Site.Data.watched.watched "id" $id) 0 }} {{- if $item }} {{- $lang :=
.Site.Language.Lang }} {{- $title := $item.title }} {{- $subtitle :=
$item.title_en }} {{- if eq $lang "en" }} {{- if $item.title_en }} {{- $title
= $item.title_en }} {{- end }} {{- $subtitle = $item.title }} {{- end }} {{-
$poster := $item.poster }} {{- if eq $lang "en" }} {{- if $item.poster_en }}
{{- $poster = $item.poster_en }} {{- else if $item.poster }} {{- $poster =
$item.poster }} {{- end }} {{- else }} {{- if $item.poster }} {{- $poster =
$item.poster }} {{- else if $item.poster_zh }} {{- $poster = $item.poster_zh }}
{{- end }} {{- end }} {{- $tmdbType := "movie" }} {{- if or (eq
$item.content_type "tv") (eq $item.content_type "tvshow") (eq
$item.content_type "show") }} {{- $tmdbType = "tv" }} {{- end }}
<article class="post-single">
  <header class="post-header">
    <div class="content-header">
      {{- if $poster }}
      <div class="content-poster-large">
        <img src="{{ $poster }}" alt="{{ $item.title }}" />
      </div>
      {{- end }}
      <div class="content-header-info">
        <h1 class="post-title">{{ $title }}</h1>
        {{- if $subtitle }}
        <p style="font-style: italic; color: var(--secondary)">
          {{ $subtitle }}
        </p>
        {{- end }}
        {{- if or $item.imdb_id $item.douban_id $item.tmdb_id }}
        <div class="external-links">
          {{- if $item.imdb_id }}
          <a
            class="imdb"
            href="https://www.imdb.com/title/{{ $item.imdb_id }}/"
            target="_blank"
            rel="noopener"
            aria-label="IMDb"
          >
            <svg class="external-link-icon" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="2.5" y="4.5" width="19" height="15" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="1.5" />
              <text x="12" y="15" text-anchor="middle" font-size="8" font-weight="700" fill="currentColor">IMDb</text>
            </svg>
            <span>IMDb</span>
          </a>
          {{- end }}
          {{- if $item.douban_id }}
          <a
            class="douban"
            href="https://movie.douban.com/subject/{{ $item.douban_id }}/"
            target="_blank"
            rel="noopener"
            aria-label="Douban"
          >
            <svg class="external-link-icon" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="2.5" y="4.5" width="19" height="15" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="1.5" />
              <text x="12" y="15" text-anchor="middle" font-size="8" font-weight="700" fill="currentColor">DB</text>
            </svg>
            <span>Douban</span>
          </a>
          {{- end }}
          {{- if $item.tmdb_id }}
          <a
            class="tmdb"
            href="https://www.themoviedb.org/{{ $tmdbType }}/{{ $item.tmdb_id }}/"
            target="_blank"
            rel="noopener"
            aria-label="TMDB"
          >
            <svg class="external-link-icon" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="2.5" y="4.5" width="19" height="15" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="1.5" />
              <text x="12" y="15" text-anchor="middle" font-size="8" font-weight="700" fill="currentColor">TMDB</text>
            </svg>
            <span>TMDB</span>
          </a>
          {{- end }}
        </div>
        {{- end }} {{- if and (or (eq $item.content_type "tv") (eq $item.content_type "tvshow"))
        $item.seasons }}
        <p style="color: var(--secondary); margin-top: 0.5rem">
          📺 电视剧 · 已看 {{ len $item.seasons }} 季
        </p>
        {{- end }}
        <div style="margin: 1rem 0">
          {{- if $item.year }}
          <p>{{ $item.year }}</p>
          {{- end }} {{- if $item.director }}
          <p>{{ $item.director }}</p>
          {{- end }}
        </div>
        {{- if and $item.rating (not (or (eq $item.content_type "tv") (eq $item.content_type "tvshow"))) }}
        <div
          style="
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            display: inline-block;
          "
        >
          <div>我的评分</div>
          <div style="font-size: 2rem; font-weight: bold">
            {{ $item.rating }}/10
          </div>
        </div>
        {{- end }}
      </div>
    </div>
  </header>

  {{- if $item.seasons }}
  <div class="seasons-section">
    <h2>分季评价</h2>
    <div class="seasons-list">
      {{- range $item.seasons }}
      <div class="season-card">
        <div class="season-header">
          {{- if .poster }}
          <div class="season-poster">
            <img src="{{ .poster }}" alt="{{ .title }}" />
          </div>
          {{- end }}
          <div class="season-info">
            <h3>第 {{ .season }} 季</h3>
            {{- if .title }}
            <p class="season-title">{{ .title }}</p>
            {{- end }}
            <div class="season-meta">
              {{- if .rating }}
              <div class="season-rating">
                <span class="rating-icon">⭐</span>
                <span class="rating-value">{{ .rating }}/10</span>
              </div>
              {{- end }} {{- if .watched_date }}
              <p class="season-date">📅 {{ .watched_date }}</p>
              {{- end }}
            </div>
          </div>
        </div>
        {{- if .review }}
        <div class="season-review">
          <h4>评价</h4>
          {{ .review | markdownify }}
        </div>
        {{- else }}
        <div class="season-review">
          <p style="color: var(--secondary); font-style: italic">暂无评价</p>
        </div>
        {{- end }}
      </div>
      {{- end }}
    </div>
  </div>
  {{- else if $item.review }}
  <div class="post-content">
    <h2>个人影评</h2>
    {{ $item.review | markdownify }}
  </div>
  {{- end }}
</article>
{{- else }}
<article class="post-single">
  <h1>内容未找到</h1>
  <p><a href="/watched/">返回列表</a></p>
</article>
{{- end }}
<style>
  .content-header {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }
  .content-poster-large {
    flex: 0 0 auto;
    width: 250px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  }
  .content-poster-large img {
    width: 100%;
    height: auto;
    display: block;
  }
  .content-header-info {
    flex: 1;
    min-width: 300px;
  }
  .external-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin: 0.75rem 0 0;
  }
  .external-links a {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.3rem 0.6rem;
    border-radius: 999px;
    background: var(--code-bg);
    color: var(--primary);
    border: 1px solid var(--border);
    font-size: 0.9rem;
    text-decoration: none;
  }
  .external-links a:hover {
    text-decoration: none;
    background: var(--entry);
  }
  .external-links a.imdb {
    color: #b58900;
  }
  .external-links a.douban {
    color: #3ca442;
  }
  .external-links a.tmdb {
    color: #1db4e4;
  }
  .external-link-icon {
    width: 18px;
    height: 18px;
    flex: 0 0 auto;
  }

  .seasons-section {
    margin: 2rem 0;
  }
  .seasons-section h2 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    color: var(--primary);
    font-size: 1.5rem;
  }
  .seasons-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  .season-card {
    background: var(--entry);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    transition: box-shadow 0.2s ease;
  }
  .season-card:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  }
  .season-header {
    display: flex;
    gap: 1.5rem;
    padding: 1.5rem;
    background: var(--code-bg);
  }
  .season-poster {
    flex: 0 0 auto;
    width: 120px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  .season-poster img {
    width: 100%;
    height: auto;
    display: block;
  }
  .season-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  .season-card h3 {
    margin: 0 0 0.5rem 0;
    color: var(--primary);
    font-size: 1.3rem;
    font-weight: 600;
  }
  .season-title {
    margin: 0 0 0.75rem 0;
    color: var(--content);
    font-size: 1.05rem;
    font-weight: 500;
  }
  .season-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
  }
  .season-rating {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    font-weight: bold;
    font-size: 0.95rem;
  }
  .rating-icon {
    font-size: 1rem;
  }
  .rating-value {
    font-size: 0.95rem;
  }
  .season-date {
    font-size: 0.9rem;
    color: var(--secondary);
    margin: 0;
  }
  .season-review {
    padding: 1.5rem;
    font-size: 0.95rem;
    line-height: 1.7;
  }
  .season-review h4 {
    margin: 0 0 0.75rem 0;
    color: var(--primary);
    font-size: 1.1rem;
    font-weight: 600;
  }
  .season-review p {
    margin: 0.5rem 0;
  }
  .season-review p:first-of-type {
    margin-top: 0;
  }
  .season-review p:last-of-type {
    margin-bottom: 0;
  }

  @media (max-width: 768px) {
    .content-header {
      flex-direction: column;
      align-items: center;
    }
    .content-poster-large {
      width: 200px;
    }
    .season-header {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .season-poster {
      width: 150px;
    }
  }
</style>
{{- end }}
